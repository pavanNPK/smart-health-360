<div class="layout-wrapper flex min-h-screen">
  <!-- Side panel menu (classic) -->
  <aside class="sidebar surface-section border-right-1 surface-border">
    <div class="sidebar-header flex align-items-center gap-2 px-3 py-3 border-bottom-1 surface-border">
      <i class="pi pi-building text-2xl" style="color: var(--brand-primary);"></i>
      <a routerLink="/" class="no-underline font-semibold text-xl text-900">Smart Health 360</a>
    </div>
    <nav class="sidebar-nav flex flex-column flex-grow-1 py-2">
      @if (user?.role === 'SUPER_ADMIN') {
        <a routerLink="/admin/dashboard" routerLinkActive="sidebar-link-active" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-th-large"></i>
          <span>Dashboard</span>
        </a>
      }
      @if (user?.role === 'DOCTOR') {
        <a routerLink="/doctor/dashboard" routerLinkActive="sidebar-link-active" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-th-large"></i>
          <span>Dashboard</span>
        </a>
        <a routerLink="/doctor/patients" routerLinkActive="sidebar-link-active" [routerLinkActiveOptions]="{ exact: false }" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-id-card"></i>
          <span>Patients</span>
        </a>
        <a routerLink="/doctor/staff" routerLinkActive="sidebar-link-active" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-users"></i>
          <span>Staff</span>
        </a>
      }
      @if (canAccess('RECEPTIONIST')) {
        <a routerLink="/reception/patients" routerLinkActive="sidebar-link-active" [routerLinkActiveOptions]="{ exact: false }" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-users"></i>
          <span>Patients</span>
        </a>
      }
      @if (canAccess('SUPER_ADMIN')) {
        <div class="px-3 py-1 text-500 text-sm font-semibold">Admin</div>
        <a routerLink="/admin/users" routerLinkActive="sidebar-link-active" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-id-card"></i>
          <span>Users</span>
        </a>
        <a routerLink="/admin/areas" routerLinkActive="sidebar-link-active" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-map"></i>
          <span>Areas</span>
        </a>
        <a routerLink="/admin/clinics" routerLinkActive="sidebar-link-active" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-building"></i>
          <span>Clinics</span>
        </a>
        <a routerLink="/admin/hierarchy" routerLinkActive="sidebar-link-active" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-sitemap"></i>
          <span>Hierarchy</span>
        </a>
      }
      @if (canAccessAudit()) {
        <div class="px-3 py-1 mt-2 text-500 text-sm font-semibold">System</div>
        <a routerLink="/audit" routerLinkActive="sidebar-link-active" class="sidebar-link flex align-items-center gap-2 px-3 py-2 no-underline text-700">
          <i class="pi pi-history"></i>
          <span>Audit</span>
        </a>
      }
    </nav>
    <div class="sidebar-footer border-top-1 surface-border px-3 py-3">
      <button
        type="button"
        class="profile-trigger w-full flex align-items-center gap-2 px-2 py-2 border-none border-round cursor-pointer surface-hover text-left"
        (click)="profilePopover.toggle($event, $any($event.currentTarget))"
        aria-label="Profile menu"
      >
        <i class="pi pi-user text-xl text-600 flex-shrink-0"></i>
        <div class="profile-trigger-text flex flex-column flex-grow-1 min-w-0 overflow-hidden">
          <span class="text-600 text-sm font-medium truncate">{{ user?.name }}</span>
          <span class="text-500 text-xs truncate">{{ user?.email }}</span>
        </div>
        <i class="pi pi-chevron-down text-500 text-xs flex-shrink-0"></i>
      </button>
      <p-popover #profilePopover [dismissable]="true" styleClass="profile-popover">
        <div class="profile-dropdown flex flex-column gap-2">
          <div class="text-900 font-semibold">{{ user?.name }}</div>
          <div class="text-600 text-sm">{{ user?.email }}</div>
          <div class="text-500 text-xs">{{ user?.role }}</div>
          @if (user?.role === 'DOCTOR' || user?.role === 'RECEPTIONIST') {
            <div class="border-top-1 surface-border pt-2 mt-1">
              <div class="text-500 text-xs">Area: {{ user?.clinic?.areaName || '—' }}</div>
              <div class="text-500 text-xs">Clinic: {{ user?.clinic?.name || '—' }}</div>
            </div>
          }
          <p-button label="Logout" icon="pi pi-sign-out" severity="secondary" (onClick)="logout(profilePopover)" styleClass="w-full mt-2"></p-button>
        </div>
      </p-popover>
    </div>
  </aside>
  <!-- Main content -->
  <main class="layout-main flex-grow-1 p-4 surface-ground overflow-auto">
    <router-outlet />
  </main>
</div>
